<div class="guest-container">
  
  <header>
    <img src="assets/img/header.png" alt="QuickProLaw" class="logo">
  </header>

  <mat-card class="auth-card" *ngIf="step() === 'loading'">
    <mat-card-content class="center-content">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Securing session...</p>
    </mat-card-content>
  </mat-card>

  <mat-card class="auth-card error-card" *ngIf="step() === 'error'">
    <mat-card-content class="center-content">
      <mat-icon color="warn" class="large-icon">error_outline</mat-icon>
      <h3>Link Expired or Invalid</h3>
      <p>Please request a new signing link from the sender.</p>
    </mat-card-content>
  </mat-card>

  <mat-card class="auth-card" *ngIf="step() === 'otp'">
    <mat-card-header>
      <mat-card-title>Verify Identity</mat-card-title>
      <mat-card-subtitle>Code sent to <strong>{{ emailMasked() }}</strong></mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="otp-input-container">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>6-Digit Code</mat-label>
          <input matInput [(ngModel)]="otpInput" maxlength="6" (keyup.enter)="verifyOtp()" placeholder="123456">
          <mat-icon matSuffix>lock</mat-icon>
        </mat-form-field>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button mat-flat-button color="primary" class="full-width-btn" (click)="verifyOtp()" [disabled]="isProcessing() || otpInput().length < 6">
        <mat-spinner diameter="20" *ngIf="isProcessing()"></mat-spinner>
        <span *ngIf="!isProcessing()">Verify Code</span>
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card class="auth-card" *ngIf="step() === 'ready'">
    <mat-card-content class="center-content">
      <div class="doc-icon-circle">
        <mat-icon class="large-icon">description</mat-icon>
      </div>
      <h2>Document Ready</h2>
      <p>Please review and sign the attached document.</p>
      
      <button mat-flat-button color="primary" class="full-width-btn" (click)="openSigningModal()" [disabled]="isProcessing()">
        Review & Sign
      </button>
    </mat-card-content>
  </mat-card>

  <mat-card class="auth-card success-card" *ngIf="step() === 'success'">
    <mat-card-content class="center-content">
      <mat-icon class="large-icon success-icon">check_circle</mat-icon>
      <h2>All Done!</h2>
      <p>The document has been successfully signed and returned.</p>
      <p class="sub-text">You can close this window now.</p>
    </mat-card-content>
  </mat-card>

</div>