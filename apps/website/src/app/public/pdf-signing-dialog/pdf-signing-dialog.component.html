<div class="signing-container">
  
  <mat-toolbar color="primary" class="sticky-header">
    <button mat-icon-button (click)="close()"><mat-icon>close</mat-icon></button>
    <span>{{ step() === 'create' ? 'Create Signature' : 'Place Signature' }}</span>
    <span class="spacer"></span>
    <button mat-button color="warn" (click)="decline()" *ngIf="step() === 'create' || step() === 'place'">
      Decline
    </button>
    <button *ngIf="step() === 'place'" mat-flat-button color="accent" (click)="signAndSave()" class="finish-btn">
      Finish
    </button>
  </mat-toolbar>

  <div class="step-container create-step" *ngIf="step() === 'create'">
    <h2>Draw Signature</h2>
    <div class="signature-pad-wrapper">
      <canvas #sigPadCanvas></canvas>
    </div>
    
    <div class="pad-actions">
      <button mat-button color="warn" (click)="clearSignature()">Clear</button>
      <button mat-flat-button color="primary" (click)="adoptDrawnSignature()">Use Drawing</button>
    </div>

    <div class="divider"><span>OR</span></div>

    <div class="alt-options">
      <button mat-stroked-button color="primary" (click)="fileInput.click()" [disabled]="isProcessing()">
        <mat-icon>cloud_upload</mat-icon>
        {{ isProcessing() ? 'Processing...' : 'Upload Image' }}
      </button>
      <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" hidden>

      <button mat-stroked-button (click)="useTextSignature()">
        <mat-icon>text_fields</mat-icon>
        Type Name
      </button>
    </div>

    <div class="privacy-note">
      <mat-icon>security</mat-icon>
      <p>
        <strong>Privacy Note:</strong> Your signature is processed locally on your device 
        to remove the background. The original image is never sent to our servers.
      </p>
    </div>
  </div>


  <div class="step-container place-step" *ngIf="step() === 'place'">
    
    <div class="controls">
      <button mat-icon-button (click)="prevPage()" [disabled]="currentPage() === 1"><mat-icon>chevron_left</mat-icon></button>
      <span>Page {{ currentPage() }} / {{ totalPages() }}</span>
      <button mat-icon-button (click)="nextPage()" [disabled]="currentPage() === totalPages()"><mat-icon>chevron_right</mat-icon></button>
    </div>

    <p class="instruction-floating">Tap anywhere to place signature</p>

    <div class="pdf-wrapper" (click)="placeSignatureAtClick($event)">
      <canvas #pdfCanvas></canvas>
      <div class="signature-overlay" 
           [style.left.px]="sigPosition.x" 
           [style.top.px]="sigPosition.y"
           (mousedown)="startDrag($event)" 
           (mouseup)="endDrag()">
         <img [src]="signatureImage" alt="Signature" class="sig-image">
      </div>
    </div>
  </div>

</div>