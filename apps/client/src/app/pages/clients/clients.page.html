<ion-header class="premium-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="navigationService.toggleSidebar()">
        <ion-icon name="menu-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    
    <ion-title>
      <div class="header-title-stack">
        <span>Clients</span>
        <span>Directory & Relationships</span>
      </div>
    </ion-title>
  </ion-toolbar>

  <ion-toolbar class="filter-toolbar">
    <div class="filter-row">
      <ion-searchbar placeholder="Search clients..." (ionInput)="onSearchChange($event)" [debounce]="500" class="custom-search"></ion-searchbar>
      
      <div class="chip-scroller">
        <ion-chip [outline]="currentFilters().status !== 'all'" (click)="toggleStatusFilter()">
          <ion-label>{{ currentFilters().status === 'all' ? 'All Status' : currentFilters().status }}</ion-label>
          <ion-icon name="chevron-down-outline"></ion-icon>
        </ion-chip>
        
        <ion-chip [outline]="currentFilters().type !== 'all'" (click)="toggleTypeFilter()">
          <ion-label>{{ currentFilters().type === 'all' ? 'All Types' : currentFilters().type }}</ion-label>
          <ion-icon name="chevron-down-outline"></ion-icon>
        </ion-chip>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="page-background">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (clientService.loading() && clientService.clients().length === 0) {
    <div class="centered-container"><ion-spinner name="crescent"></ion-spinner></div>
  } 
  @else if (!clientService.loading() && clientService.clients().length === 0) {
    <div class="empty-state">
      <ion-icon name="people-outline"></ion-icon>
      <h3>No Clients Found</h3>
      <p>Add a new client to get started.</p>
    </div>
  } 
  @else {
    <div class="client-grid">
      @for (client of clientService.clients(); track client.id) {
        <div class="client-card" (click)="openClientDetail(client.id)">
          
          <div class="card-left">
            <div class="avatar-circle">
              {{ client.fullname.charAt(0) }}
            </div>
          </div>

          <div class="card-center">
            <div class="name-row">
              <h3>{{ client.fullname }}</h3>
              @if (client.clientType === 'Corporate') {
                <ion-icon name="business" class="corp-icon" title="Corporate"></ion-icon>
              }
            </div>
            
            <div class="detail-row">
              <span>{{ client.email }}</span>
              <span class="dot">â€¢</span>
              <span>{{ client.phoneNumber }}</span>
            </div>

            <div class="badge-row">
              <span class="status-pill {{ (client.status || 'Active').toLowerCase() }}">
                {{ client.status || 'Active' }}
              </span>
              
              @if (client.kycStatus) {
                <span class="kyc-pill {{ client.kycStatus.toLowerCase() }}">
                  KYC: {{ client.kycStatus }}
                </span>
              }
            </div>
          </div>

          <div class="card-actions">
            <ion-button fill="clear" (click)="contactClient($event, 'call', client.phoneNumber)">
              <ion-icon slot="icon-only" name="call-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" (click)="contactClient($event, 'mail', client.email)">
              <ion-icon slot="icon-only" name="mail-outline"></ion-icon>
            </ion-button>
          </div>

        </div>
      }
    </div>

    <ion-infinite-scroll (ionInfinite)="onIonInfinite($event)">
      <ion-infinite-scroll-content loadingSpinner="bubbles"></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  }

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="openClientForm()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>