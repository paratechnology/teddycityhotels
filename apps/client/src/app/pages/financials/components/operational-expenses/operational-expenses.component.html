<div class="expenses-wrapper">
  
  @if (financialsService.status() === 'loading' && financialsService.operationalExpenses().length === 0) {
    <div class="centered-container">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  } 
  @else if (financialsService.status() === 'error') {
    <div class="centered-container ion-padding ion-text-center">
      <ion-label color="danger">Failed to load expenses.</ion-label>
      <ion-button (click)="loadExpenses()" fill="outline" class="ion-margin-top">Retry</ion-button>
    </div>
  } 
  @else {
    <ion-list [inset]="true">
      @for (expense of financialsService.operationalExpenses(); track expense.id) {
        <ion-item-sliding>
          <ion-item [button]="isAdmin() && expense.status === 'Pending'" detail="false">
            <ion-label>
              <h2>{{ expense.description }}</h2>
              <p>Amount: <strong>₦{{ expense.amount.toLocaleString() }}</strong></p>
              <div class="meta-row">
                <span>{{ expense.date | date:'mediumDate' }}</span>
                @if (isAdmin()) {
                  <span class="dot">•</span>
                  <span>{{ expense.requestedBy.fullname }}</span>
                }
              </div>
            </ion-label>
            <ion-chip [color]="getStatusColor(expense.status)" slot="end" mode="ios">
              {{ expense.status }}
            </ion-chip>
          </ion-item>

          @if (isAdmin() && expense.status === 'Pending') {
            <ion-item-options side="end">
              <ion-item-option color="success" (click)="handleApproval(expense, 'Approved')">
                <ion-icon slot="icon-only" name="checkmark"></ion-icon>
              </ion-item-option>
              <ion-item-option color="danger" (click)="handleApproval(expense, 'Rejected')">
                <ion-icon slot="icon-only" name="close"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          }
        </ion-item-sliding>
      } @empty {
        <div class="empty-state">
          <ion-icon name="receipt-outline"></ion-icon>
          <p>No operational expenses found.</p>
        </div>
      }
    </ion-list>
  }
</div>